<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FC Hanley Guestbook</title>
    <link rel="stylesheet" href="styles/styles.css" />
    <link rel="stylesheet" href="styles/guestbook.css" />

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>

<body>

    <!-- Header -->
    <header class="club-header">
        <a href="index.html">
            <img src="images/HanleyBadge.png" alt="FC Hanley Badge" class="badge">
        </a>
    </header>

    <!-- Navigation -->
    <nav class="navbar">
        <ul>
            <li><a href="fixtures.html">Fixtures</a></li>
            <li><a href="gallery.html">Gallery</a></li>
            <li><a href="news.html">News & Events</a></li>
            <li><a href="holidaycamps.html">Holiday Camps</a></li>
            <li><a href="toptier.html">Top Tier Trophies</a></li>
            <li><a href="subz.html">Subz</a></li>
            <li><a href="guestbook.html">feedback</a></li>
        </ul>
    </nav>

<!-- Guestbook Content -->
<div class="guestbook-container">
    <h2 class="guestbook-title">FC Hanley Guestbook</h2>
    <p class="guestbook-intro">
        We'd love to hear your comments, feedback and suggestions from your experience at FC Hanley.
        Please leave a message or shoutout!
    </p>

        <form id="guestbookForm" class="guestbook-form">
            <input type="text" id="guestName" placeholder="Your Name" required />
            <textarea id="guestMessage" rows="4" placeholder="Your Message" required></textarea>
            <button type="submit">Post Message</button>
        </form>

        <div id="commentList"></div>
        
        <!-- Admin Controls -->
        <button id="adminLoginBtn" class="admin-btn">Admin Login</button>
        <button id="clearCommentsBtn" class="clear-btn" style="display:none;">Clear All Messages</button>
    </div>

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 FC Hanley. All rights reserved.</p>
    </footer>

    <script>
        // Your Firebase configuration â€” replace with your real config
        const firebaseConfig = {
            apiKey: "AIzaSyDXXX-LMkY4Q0oN0M9e5wLdVhANzL8ifHs",
            authDomain: "fchanley-8d910.firebaseapp.com",
            databaseURL: "https://fchanley-8d910-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "fchanley-8d910",
            storageBucket: "fchanley-8d910.firebasestorage.app",
            messagingSenderId: "384977183977",
            appId: "1:384977183977:web:7805c8ba7e9122b883bc78",
            measurementId: "G-1CBV4NK83L"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const form = document.getElementById('guestbookForm');
        const commentList = document.getElementById('commentList');
        const clearBtn = document.getElementById('clearCommentsBtn');
        const adminLoginBtn = document.getElementById('adminLoginBtn');

        // Load comments from Firebase realtime database
        function loadComments() {
            commentList.innerHTML = "Loading messages...";
            db.ref('guestbookMessages').orderByChild('timestamp').once('value', snapshot => {
                const comments = [];
                snapshot.forEach(childSnapshot => {
                    comments.push(childSnapshot.val());
                });
                comments.reverse(); // newest first
                if (comments.length === 0) {
                    commentList.innerHTML = "<p>No messages yet. Be the first to post!</p>";
                    return;
                }
                commentList.innerHTML = comments.map(c => `
                    <div class="comment">
                        <h4>${escapeHtml(c.name)}</h4>
                        <small>${new Date(c.timestamp).toLocaleString()}</small>
                        <p>${escapeHtml(c.message)}</p>
                    </div>
                `).join('');
            });
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            return text.replace(/[&<>"']/g, function(m) {
                return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];
            });
        }

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('guestName').value.trim();
            const message = document.getElementById('guestMessage').value.trim();

            if (!name || !message) return;

            // Push new comment to Firebase
            db.ref('guestbookMessages').push({
                name,
                message,
                timestamp: Date.now()
            }).then(() => {
                form.reset();
                loadComments();
            }).catch(error => {
                alert("Error posting message: " + error.message);
            });
        });

        // Admin password
        const adminPassword = "hanley123"; // Change as needed

        // Check if admin already logged in this session
        function setAdminMode() {
            clearBtn.style.display = 'inline-block';
            adminLoginBtn.style.display = 'none';
            sessionStorage.setItem('isAdmin', 'true');
        }

        if (sessionStorage.getItem('isAdmin') === 'true') {
            setAdminMode();
        }

        // Admin Login button click
        adminLoginBtn.addEventListener('click', () => {
            const enteredPassword = prompt("Enter admin password:");
            if (enteredPassword === adminPassword) {
                setAdminMode();
                alert("Admin mode enabled.");
            } else {
                alert("Incorrect password.");
            }
        });

        clearBtn.addEventListener('click', () => {
            if (confirm("Are you sure you want to delete all guestbook messages?")) {
                db.ref('guestbookMessages').remove()
                .then(() => {
                    alert("All messages cleared.");
                    loadComments();
                }).catch(error => {
                    alert("Error clearing messages: " + error.message);
                });
            }
        });

        // Initial load
        loadComments();
    </script>

</body>
</html>
